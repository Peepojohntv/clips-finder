<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Twitch Clip Finder + Editor</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0e0e16;
  color:white;
}

.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
}

input,button{
  padding:10px;
  border-radius:8px;
  border:none;
  margin:5px 0;
}

button{
  background:#9146ff;
  color:white;
  cursor:pointer;
  font-weight:bold;
}

button:hover{ background:#772ce8; }

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
  gap:20px;
  margin-top:20px;
}

.clip{
  background:#1a1a24;
  border-radius:12px;
  overflow:hidden;
  cursor:pointer;
  transition:0.2s;
}

.clip:hover{
  transform:translateY(-5px);
}

.clip img{
  width:100%;
  display:block;
}

.clip-body{
  padding:10px;
}

.editor-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  z-index:9999;
  padding:40px;
  overflow:auto;
}

.editor-container{
  max-width:1200px;
  margin:auto;
}

.video-wrap{
  position:relative;
}

#editorVideo{
  width:100%;
  border-radius:12px;
}

#textOverlay{
  position:absolute;
  top:20px;
  left:20px;
  font-size:32px;
  font-weight:bold;
  color:white;
  cursor:move;
}

.controls{
  background:#1a1a24;
  padding:20px;
  border-radius:12px;
}

.controls label{
  font-size:12px;
  display:block;
  margin-top:10px;
}

.close-btn{
  background:#333;
}
</style>
</head>

<body>

<div class="container">
  <h1>Twitch Clip Finder</h1>

  <input type="text" id="clientId" placeholder="Client ID">
  <input type="text" id="token" placeholder="Access Token">
  <input type="text" id="login" placeholder="Streamer Login">

  <input type="datetime-local" id="from">
  <input type="datetime-local" id="to">

  <button onclick="searchClips()">Clips suchen</button>

  <div id="results" class="grid"></div>
</div>


<!-- EDITOR -->
<div id="editorModal" class="editor-modal">
  <div class="editor-container">

    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h2>Clip Editor</h2>
      <button onclick="closeEditor()" class="close-btn">Schlie√üen</button>
    </div>

    <div style="display:grid; grid-template-columns:2fr 1fr; gap:20px;">

      <div>
        <div class="video-wrap">
          <video id="editorVideo" controls></video>
          <div id="textOverlay" contenteditable="true"></div>
        </div>
      </div>

      <div class="controls">
        <label>Start (Sek)</label>
        <input type="number" id="trimStart" value="0">

        <label>Ende (Sek)</label>
        <input type="number" id="trimEnd" value="10">

        <label>Geschwindigkeit</label>
        <input type="range" min="0.25" max="2" step="0.25" value="1" id="speed">

        <label>Lautst√§rke</label>
        <input type="range" min="0" max="1" step="0.1" value="1" id="volume">

        <label>Helligkeit</label>
        <input type="range" min="0.5" max="2" step="0.1" value="1" id="brightness">

        <label>Kontrast</label>
        <input type="range" min="0.5" max="2" step="0.1" value="1" id="contrast">

        <label>Text</label>
        <input type="text" id="textInput">

        <button onclick="takeScreenshot()">Screenshot</button>
      </div>

    </div>
  </div>
</div>


<script>
let currentClip = null;

async function searchClips(){
  const clientId = document.getElementById("clientId").value;
  const token = document.getElementById("token").value;
  const login = document.getElementById("login").value;
  const from = new Date(document.getElementById("from").value).toISOString();
  const to = new Date(document.getElementById("to").value).toISOString();

  const userRes = await fetch(`https://api.twitch.tv/helix/users?login=${login}`,{
    headers:{
      "Client-ID":clientId,
      "Authorization":"Bearer "+token
    }
  });
  const userData = await userRes.json();
  const id = userData.data[0].id;

  const clipRes = await fetch(`https://api.twitch.tv/helix/clips?broadcaster_id=${id}&started_at=${from}&ended_at=${to}&first=20`,{
    headers:{
      "Client-ID":clientId,
      "Authorization":"Bearer "+token
    }
  });

  const clipData = await clipRes.json();
  renderClips(clipData.data);
}

function renderClips(clips){
  const results = document.getElementById("results");
  results.innerHTML = "";

  clips.forEach(c=>{
    const div = document.createElement("div");
    div.className="clip";
    div.innerHTML=`
      <img src="${c.thumbnail_url.replace('%{width}','480').replace('%{height}','272')}">
      <div class="clip-body">
        <b>${c.title}</b><br>
        üëÅ ${c.view_count}
      </div>
    `;
    div.onclick=()=>openEditor(c.url);
    results.appendChild(div);
  });
}

function openEditor(url){
  currentClip=url;
  const video=document.getElementById("editorVideo");
  video.src=url;
  video.play();
  document.getElementById("editorModal").style.display="block";
}

function closeEditor(){
  document.getElementById("editorModal").style.display="none";
  document.getElementById("editorVideo").pause();
}

document.getElementById("speed").oninput=e=>{
  document.getElementById("editorVideo").playbackRate=e.target.value;
};

document.getElementById("volume").oninput=e=>{
  document.getElementById("editorVideo").volume=e.target.value;
};

function applyFilters(){
  const b=document.getElementById("brightness").value;
  const c=document.getElementById("contrast").value;
  document.getElementById("editorVideo").style.filter=
    `brightness(${b}) contrast(${c})`;
}

document.getElementById("brightness").oninput=applyFilters;
document.getElementById("contrast").oninput=applyFilters;

document.getElementById("textInput").oninput=e=>{
  document.getElementById("textOverlay").innerText=e.target.value;
};

function takeScreenshot(){
  const video=document.getElementById("editorVideo");
  const canvas=document.createElement("canvas");
  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
  const ctx=canvas.getContext("2d");
  ctx.drawImage(video,0,0);
  const link=document.createElement("a");
  link.download="screenshot.png";
  link.href=canvas.toDataURL();
  link.click();
}
</script>

</body>
</html>
